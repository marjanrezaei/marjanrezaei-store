{% extends 'dashboard/customer/base.html' %}
{% load static i18n %}
{% block Breadcrumb %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb breadcrumb-light mb-0">
    <li class="breadcrumb-item">{% trans "Account" %}</li>
    <li class="breadcrumb-item">{% trans "Dashboard" %}</li>
    <li class="breadcrumb-item active" aria-current="page">
      {% trans "Orders" %}
    </li>
  </ol>
</nav>
{% endblock %}

{% block customer_content %}
<!-- Card -->
<div class="card">
  <!-- Header -->
  <div class="card-header border-bottom">
    <form action="." class="row">
      <div class="col-md-3 py-1">
        <select class="form-select form-select-sm" id="order-by-filter" name="order_by">
          <option value="" selected>{% trans "Sort by" %}</option>
          <option value="-created_at">{% trans "Newest" %}</option>
          <option value="created_at">{% trans "Oldest" %}</option>
          <option value="-total_price">{% trans "Highest Price" %}</option>
          <option value="total_price">{% trans "Lowest Price" %}</option>
        </select>
      </div>
      <div class="col-md-3 py-1">
        <select class="form-select form-select-sm" id="status-id-filter" name="status">
          <option value="" selected>{% trans "Status" %}</option>
          {% for id, label in status_types %}
          <option value="{{id}}">{{label}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2 py-1">
        <select class="form-select form-select-sm" id="page-size-filter">
          <option value="" selected>{% trans "Page size" %}</option>
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="50">50</option>
        </select>
      </div>
      <div class="col-md-1 py-1">
        <button type="submit" class="btn btn-primary btn-search"><i class="bi-search"></i></button>
      </div>
    </form>
  </div>
  <!-- End Header -->

  <!-- Body -->
  <div class="card-body">
    <!-- Tab Content -->
    <div class="tab-content" id="accountOrdersTabContent">
      <div class="tab-pane fade show active" id="accountOrdersOne" role="tabpanel"
        aria-labelledby="accountOrdersOne-tab">
        
        <!-- Select Group -->
        <div class="d-sm-flex align-items-sm-center mb-5">
          <div class="mb-2 mb-sm-0 me-3">
            <span><strong class="text-dark">{{ total_items }} {% trans "orders" %}</strong></span>
          </div>
        </div>
        <!-- End Select Group -->

        <ul class="list-unstyled mb-5">
          <!-- Card -->
          {% for object in object_list %}
          <li class="card card-bordered shadow-none mb-3">
            <div class="card-body">
              <div class="row">
                <div class="col-6 col-md mb-3 mb-md-0">
                  <small class="card-subtitle mb-0">{% trans "Order Amount" %}</small>
                  <small class="text-dark fw-semibold">{{ object.total_price }}</small>
                </div>
                <!-- End Col -->

                <div class="col-6 col-md mb-3 mb-md-0">
                  <small class="card-subtitle mb-0">{% trans "Status" %}</small>
                  <small class="text-dark fw-semibold">{{ object.get_status.label }}</small>
                </div>
                <!-- End Col -->

                <div class="col-6 col-md">
                  <small class="card-subtitle mb-0">{% trans "Order Number" %}</small>
                  <small class="text-dark fw-semibold">{{ object.id }}</small>
                </div>
                <!-- End Col -->

                <div class="col-6 col-md">
                  <small class="card-subtitle mb-0">{% trans "Order Date" %}</small>
                  <small class="text-dark fw-semibold">{{ object.created_at|date:"Y-m-d h:i" }}</small>
                </div>
                <!-- End Col -->
              </div>
              <!-- End Row -->

              <hr>

              <div class="row">
                <div class="col-md-8">
                  <div class="row gx-2">
                    {% for order_item in object.order_items.all|slice:":4" %}
                    <div class="col">
                      <img class="img-fluid" src="{{order_item.product.image.url}}" alt="{% trans 'Product Image' %}">
                    </div>
                    {% endfor %}
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="d-grid gap-2">
                    {% if object.is_successful %}
                    <a class="btn btn-white btn-sm" href="{% url 'dashboard:customer:order-invoice' pk=object.pk %}"
                      target="_blank">
                      <i class="bi-receipt small me-2"></i> {% trans "View Invoice" %}
                    </a>
                    {% endif %}
                    <a class="btn btn-primary btn-sm"
                      href="{% url 'dashboard:customer:order-detail' pk=object.pk %}">{% trans "View Order" %}</a>
                  </div>
                </div>
              </div>
            </div>
          </li>
          {% endfor %}
        </ul>

        <!-- Pagination -->
        {% if page_obj.has_other_pages %}
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item">
              <button class="page-link" onclick="changePage('{{ page_obj.previous_page_number }}')"
                aria-label="{% trans 'Previous' %}">
                <i class="bi-chevron-double-right small"></i>
              </button>
            </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
            {% if num == page_obj.number %}
            <li class="page-item active">
              <button class="page-link" onclick="changePage('{{num}}')">{{ num }}</button>
            </li>
            {% elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
            <li class="page-item">
              <button class="page-link" onclick="changePage('{{num}}')">{{ num }}</button>
            </li>
            {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item">
              <button class="page-link" onclick="changePage('{{ page_obj.next_page_number }}')" aria-label="{% trans 'Next' %}">
                <i class="bi-chevron-double-left small"></i>
              </button>
            </li>
            {% endif %}
          </ul>
        </nav>
        {% endif %}
        <!-- End Pagination -->
      </div>
    </div>
  </div>
</div>
{% endblock %}
