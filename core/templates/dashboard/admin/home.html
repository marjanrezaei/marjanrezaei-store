{% extends 'dashboard/admin/base.html' %}
{% load i18n %}

{% block Breadcrumb %}
<nav aria-label="breadcrumb">
  <ol class="breadcrumb breadcrumb-light mb-0">
    <li class="breadcrumb-item">{% trans "Account" %}</li>
    <li class="breadcrumb-item active" aria-current="page">
      {% trans "Admin Dashboard" %}
    </li>
  </ol>
</nav>
{% endblock %}

{% block dashboard_content %}
<!-- Card -->
<div class="card">
  <!-- Header -->
  <div class="card-header border-bottom">
    <h5 class="card-header-title">{% trans "Dashboard Summary" %}</h5>
  </div>
  <!-- End Header -->
  <!-- Body -->
  <div class="card-body">
    <div class="row" id="dashboard-summary">

    </div>
  </div>
  <!-- End Body -->
</div>
<!-- End Card -->

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', async () => {
    try {
        const accessToken = localStorage.getItem('access_token'); 
        if (!accessToken) {
            console.warn("{% trans 'Access token not found' %}");
            return;
        }

        const response = await fetch('/api/dashboard/admin/', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`
            }
        });

        if (!response.ok) {
            console.error("{% trans 'Error fetching dashboard data:' %}", response.status);
            return;
        }

        const data = await response.json();
        const container = document.getElementById('dashboard-summary');

        // کارت‌ها با Bootstrap
        container.innerHTML = `
            <div class="col-md-4 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">{% trans "Users Count" %}</h6>
                        <p class="card-text">${data.user_count || 0}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">{% trans "Products Count" %}</h6>
                        <p class="card-text">${data.products_count || 0}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">{% trans "Orders Count" %}</h6>
                        <p class="card-text">${data.orders_count || 0}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6 class="card-title">{% trans "Coupons Count" %}</h6>
                        <p class="card-text">${data.coupons_count || 0}</p>
                    </div>
                </div>
            </div>
        `;
    } catch (err) {
        console.error("{% trans 'Error:' %}", err);
        document.getElementById('dashboard-summary').innerHTML =
            '<p class="text-danger">{% trans "Unable to load dashboard data." %}</p>';
    }
});
</script>
{% endblock %}
