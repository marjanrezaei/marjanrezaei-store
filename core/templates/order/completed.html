{% extends 'base.html' %}
{% load static i18n %}

{% block content %}
<div class="container content-space-2 content-space-lg-3">
  <div class="w-md-75 w-lg-50 text-center mx-md-auto">
    <div class="mb-5">
      <img class="img-fluid" src="{% static 'svg/illustrations/oc-hi-five.svg' %}" alt="Image Description" style="width: 15rem;">
    </div>

    <div class="mb-5">
      <h1 class="h2">سفارش شما تکمیل شد!</h1>
      <p id="order_info">
        لطفا صبر کنید... اطلاعات سفارش در حال بارگذاری است.
      </p>
    </div>

    <a class="btn btn-primary btn-transition rounded-pill px-6" href="{% url 'shop:product-list' %}">به خرید ادامه دهید</a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const orderId = "{{ order_id }}";  // Pass this from Django view
    const apiUrl = `/api/order/${orderId}/detail/`;

    fetch(apiUrl, {
        headers: {
            'Authorization': 'Token {{ user.auth_token.key }}' // if using token auth
        }
    })
    .then(res => res.json())
    .then(data => {
        const info = document.getElementById('order_info');
        info.innerHTML = `
            شماره سفارش: <strong>#${data.id}</strong><br>
            وضعیت: <strong>${data.status}</strong><br>
            مجموع: <strong>${data.total_price} تومان</strong><br>
            <ul>
                ${data.items.map(item => `<li>${item.product} × ${item.quantity} - ${item.price} تومان</li>`).join('')}
            </ul>
        `;
    })
    .catch(err => {
        document.getElementById('order_info').textContent = 'خطا در بارگذاری اطلاعات سفارش';
        console.error(err);
    });
});
</script>
{% endblock %}