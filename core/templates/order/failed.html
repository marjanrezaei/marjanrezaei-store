{% extends 'base.html' %}
{% load static i18n %}

{% block content %}
<div class="container content-space-2 content-space-lg-3">
  <div class="w-md-75 w-lg-50 text-center mx-md-auto">
    <div class="mb-5">
      <img class="img-fluid" src="{% static 'svg/illustrations/oc-hi-five.svg' %}" alt="Image Description" style="width: 15rem;">
    </div>

    <div class="mb-5">
      <h1 class="h2" id="order_status_heading">در حال بررسی سفارش...</h1>
      <p id="order_status_message"></p>
    </div>

    <a class="btn btn-primary btn-transition rounded-pill px-6" href="{% url 'shop:product-list' %}">به خرید ادامه دهید</a>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    const orderId = "{{ order_id }}";  // Pass from Django view
    const apiUrl = `/api/order/${orderId}/status/`;

    fetch(apiUrl, {
        headers: {
            'Authorization': 'Token {{ user.auth_token.key }}' // if using token auth
        }
    })
    .then(res => res.json())
    .then(data => {
        const heading = document.getElementById('order_status_heading');
        const message = document.getElementById('order_status_message');

        if (data.status === 'completed') {
            heading.textContent = 'سفارش شما تکمیل شد!';
            message.innerHTML = `
                شماره سفارش: <strong>#${data.id}</strong><br>
                مجموع: <strong>${data.total_price} تومان</strong>
            `;
        } else {
            heading.textContent = 'سفارش شما با مشکل مواجه شد!';
            message.textContent = 'لطفا دوباره تلاش کنید یا با پشتیبانی تماس بگیرید.';
        }
    })
    .catch(err => {
        document.getElementById('order_status_heading').textContent = 'خطا در بارگذاری اطلاعات سفارش';
        console.error(err);
    });
});
</script>
{% endblock %}
